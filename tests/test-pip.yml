---
- hosts: all
  become: true
  vars:
    dbname: synapse
    dbuser: synapse_user
    dbpw: synapse_password
  roles:
    - role: geerlingguy.pip
    - role: geerlingguy.postgresql
      postgresql_databases:
        - name: "{{ dbname }}"
      postgresql_users:
        - name: "{{ dbuser }}"
          password: "{{ dbpw }}"
      postgresql_global_config_options:
        - option: listen_address
          value: "*"
    - role: matrix-ansible-synapse
      matrix_server_name: localhost
      matrix_synapse_report_stats: false
      matrix_synapse_pg_host: localhost
      matrix_synapse_pg_user: "{{ dbuser }}"
      matrix_synapse_pg_pass: "{{ dbpw }}"
      matrix_synapse_pg_db: "{{ dbname }}"
      matrix_synapse_macaroon_secret_key: "THIS_IS_TOTALLY_SECRET_1337_L33T_HaxXxOR"
      matrix_synapse_registration_secret: "ahphae6shuighahxaf9weeBahHieCh8woo6agh6UGh"
      matrix_synapse_extra_config:
        no_tls: true
